<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV/JSON è½¬æ¢å™¨ - AIå·¥å…·é›†</title>
    <meta name="description" content="CSV/JSON è½¬æ¢å™¨">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="../../shared/css/common.css">
    
    <!-- å·¥å…·ç‰¹å®šæ ·å¼ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            min-height: 100vh;
            padding: var(--spacing-lg);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #0984e3;
            border-bottom: 3px solid #0984e3;
        }

        .tab:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .converter-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-box, .output-box {
            background: #f8f9fa;
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .box-header h3 {
            color: #495057;
            font-size: 1.3em;
        }

        .file-upload {
            position: relative;
            display: inline-block;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-btn {
            padding: 8px 15px;
            background: #6c757d;
            color: white;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-upload-btn:hover {
            background: #5a6268;
        }

        textarea {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: var(--radius-md);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #0984e3;
        }

        .controls {
            margin: var(--spacing-lg) 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
        }

        .control-group input, .control-group select {
            padding: 6px 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .preview-table {
            max-height: 300px;
            overflow: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-top: 15px;
        }

        .preview-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .preview-table th,
        .preview-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            font-size: 13px;
        }

        .preview-table th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .preview-table tr:hover {
            background: #f8f9fa;
        }

        .footer {
            text-align: center;
            padding: var(--spacing-lg);
            background: #f8f9fa;
            color: #6c757d;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .converter-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tab-content {
                padding: var(--spacing-lg);
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="tool-container">
        <!-- å·¥å…·å¤´éƒ¨ -->
        <header class="tool-header">
            <div class="tool-header-content">
                <a href="../../index.html" class="back-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M10 4l-4 4 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    è¿”å›å·¥å…·é›†
                </a>
                
                <div class="tool-title">
                    <h1>CSV/JSON è½¬æ¢å™¨</h1>
                    <p class="tool-subtitle">CSV/JSON è½¬æ¢å™¨</p>
                </div>
                
                <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2"/>
                        <path d="M10 2v2M10 16v2M18 10h-2M4 10H2M15.66 4.34l-1.41 1.41M5.75 14.25l-1.41 1.41M15.66 15.66l-1.41-1.41M5.75 5.75L4.34 4.34" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- å·¥å…·ä¸»å†…å®¹ -->
        <main class="tool-main">
            <div class="tool-card">
                <div class="tool-section">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        å·¥å…·åŠŸèƒ½
                    </h2>
                    
                    
            <div class="tool-card">
                <div class="tool-section">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        CSV/JSON è½¬æ¢å™¨
                    </h2>
                    <div class="container">
        <div class="header">
            <h1>ğŸ”„ CSV/JSON è½¬æ¢å™¨</h1>
            <p>å®¢æˆ·ç«¯è§£æ CSV æ–‡ä»¶å¹¶è½¬æ¢ä¸º JSONï¼Œæˆ–åä¹‹</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('csv-to-json')">ğŸ“Š CSV â†’ JSON</button>
            <button class="tab" onclick="switchTab('json-to-csv')">ğŸ“‹ JSON â†’ CSV</button>
        </div>

        <!-- CSV to JSON Tab -->
        <div id="csv-to-json" class="tab-content active">
            <div class="converter-section">
                <div class="input-box">
                    <div class="box-header">
                        <h3>CSV è¾“å…¥</h3>
                        <div class="file-upload">
                            <input type="file" id="csvFile" accept=".csv" onchange="loadCsvFile(this)">
                            <div class="file-upload-btn">ğŸ“ é€‰æ‹©æ–‡ä»¶</div>
                        </div>
                    </div>
                    <textarea id="csvInput" placeholder="ç²˜è´´æ‚¨çš„ CSV æ•°æ®ï¼Œæˆ–ä½¿ç”¨ä¸Šæ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶ï¼š

å§“å,å¹´é¾„,åŸå¸‚,èŒä¸š
å¼ ä¸‰,28,åŒ—äº¬,å·¥ç¨‹å¸ˆ
æå››,32,ä¸Šæµ·,è®¾è®¡å¸ˆ
ç‹äº”,25,å¹¿å·,äº§å“ç»ç†"></textarea>
                    
                    <div class="controls">
                        <div class="control-group">
                            <label>åˆ†éš”ç¬¦:</label>
                            <select id="csvDelimiter">
                                <option value=",">é€—å· (,)</option>
                                <option value=";">åˆ†å· (;)</option>
                                <option value="\t">åˆ¶è¡¨ç¬¦ (\t)</option>
                                <option value="|">ç«–çº¿ (|)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="hasHeader" checked>
                            <label for="hasHeader">åŒ…å«æ ‡é¢˜è¡Œ</label>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="trimSpaces" checked>
                            <label for="trimSpaces">å»é™¤ç©ºæ ¼</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn-primary" onclick="convertCsvToJson()">ğŸ”„ è½¬æ¢ä¸º JSON</button>
                        <button class="btn-secondary" onclick="clearCsvInput()">ğŸ—‘ï¸ æ¸…ç©º</button>
                    </div>
                </div>

                <div class="output-box">
                    <div class="box-header">
                        <h3>JSON è¾“å‡º</h3>
                        <div class="control-group">
                            <label>æ ¼å¼:</label>
                            <select id="jsonFormat">
                                <option value="array">æ•°ç»„æ ¼å¼</option>
                                <option value="object">å¯¹è±¡æ ¼å¼</option>
                            </select>
                        </div>
                    </div>
                    <textarea id="jsonOutput" placeholder="è½¬æ¢åçš„ JSON æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
                    
                    <div class="btn-group">
                        <button class="btn-success" onclick="copyJsonOutput()">ğŸ“‹ å¤åˆ¶</button>
                        <button class="btn-warning" onclick="downloadJson()">ğŸ’¾ ä¸‹è½½</button>
                        <button class="btn-secondary" onclick="previewData('json')">ğŸ‘ï¸ é¢„è§ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- JSON to CSV Tab -->
        <div id="json-to-csv" class="tab-content">
            <div class="converter-section">
                <div class="input-box">
                    <div class="box-header">
                        <h3>JSON è¾“å…¥</h3>
                        <div class="file-upload">
                            <input type="file" id="jsonFile" accept=".json" onchange="loadJsonFile(this)">
                            <div class="file-upload-btn">ğŸ“ é€‰æ‹©æ–‡ä»¶</div>
                        </div>
                    </div>
                    <textarea id="jsonInput" placeholder="ç²˜è´´æ‚¨çš„ JSON æ•°æ®ï¼Œæˆ–ä½¿ç”¨ä¸Šæ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶ï¼š

[
  {
    &quot;å§“å&quot;: &quot;å¼ ä¸‰&quot;,
    &quot;å¹´é¾„&quot;: 28,
    &quot;åŸå¸‚&quot;: &quot;åŒ—äº¬&quot;,
    &quot;èŒä¸š&quot;: &quot;å·¥ç¨‹å¸ˆ&quot;
  },
  {
    &quot;å§“å&quot;: &quot;æå››&quot;,
    &quot;å¹´é¾„&quot;: 32,
    &quot;åŸå¸‚&quot;: &quot;ä¸Šæµ·&quot;,
    &quot;èŒä¸š&quot;: &quot;è®¾è®¡å¸ˆ&quot;
  }
]"></textarea>
                    
                    <div class="controls">
                        <div class="control-group">
                            <label>è¾“å‡ºåˆ†éš”ç¬¦:</label>
                            <select id="outputDelimiter">
                                <option value=",">é€—å· (,)</option>
                                <option value=";">åˆ†å· (;)</option>
                                <option value="\t">åˆ¶è¡¨ç¬¦ (\t)</option>
                                <option value="|">ç«–çº¿ (|)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="includeHeader" checked>
                            <label for="includeHeader">åŒ…å«æ ‡é¢˜è¡Œ</label>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="flattenNested">
                            <label for="flattenNested">å±•å¼€åµŒå¥—å¯¹è±¡</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn-primary" onclick="convertJsonToCsv()">ğŸ”„ è½¬æ¢ä¸º CSV</button>
                        <button class="btn-secondary" onclick="clearJsonInput()">ğŸ—‘ï¸ æ¸…ç©º</button>
                    </div>
                </div>

                <div class="output-box">
                    <div class="box-header">
                        <h3>CSV è¾“å‡º</h3>
                    </div>
                    <textarea id="csvOutput" placeholder="è½¬æ¢åçš„ CSV æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
                    
                    <div class="btn-group">
                        <button class="btn-success" onclick="copyCsvOutput()">ğŸ“‹ å¤åˆ¶</button>
                        <button class="btn-warning" onclick="downloadCsv()">ğŸ’¾ ä¸‹è½½</button>
                        <button class="btn-secondary" onclick="previewData('csv')">ğŸ‘ï¸ é¢„è§ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="status" class="status" style="display: none;"></div>
        <div id="previewContainer" class="preview-table" style="display: none;"></div>

        <div class="footer">
            <p>ğŸ’¡ æ”¯æŒå¤šç§åˆ†éš”ç¬¦ã€åµŒå¥—å¯¹è±¡å±•å¼€ã€æ•°æ®é¢„è§ˆç­‰åŠŸèƒ½</p>
            <p>è„šæ³¨ï¼šå°è‹è¶£ç ”AI - è®©æ•°æ®æ ¼å¼è½¬æ¢å˜å¾—ç®€å•é«˜æ•ˆ</p>
        </div>
    </div>

    
                </div>
            </div>
                    <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
                    <div class="result-display" id="result">
                        <pre id="resultContent">å¤„ç†ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</pre>
                    </div>
                </div>
            </div>
        </main>

        <!-- å·¥å…·é¡µè„š -->
        <footer class="tool-footer">
            <p>ç”± <a href="../../index.html">AIå·¥å…·é›†</a> æä¾› | åŸåˆ›å·¥å…·</p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="../../shared/js/utils.js"></script>
    <script>
        // å·¥å…·ç‰¹å®šçš„JavaScriptä»£ç 
        class ToolApp {
            constructor() {
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('processBtn').addEventListener('click', () => this.process());
                document.getElementById('clearBtn').addEventListener('click', () => this.clear());
                document.getElementById('copyBtn').addEventListener('click', () => this.copyResult());
                
                // å®æ—¶å¤„ç†ï¼ˆå¯é€‰ï¼‰
                document.getElementById('input').addEventListener('input', 
                    ToolUtils.debounce(() => this.process(), 300)
                );
            }

            process() {
                const input = document.getElementById('input').value;
                const result = this.processInput(input);
                this.displayResult(result);
            }

            processInput(input) {
                
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabId).classList.add('active');
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾
            event.target.classList.add('active');
            
            // éšè—é¢„è§ˆ
            document.getElementById('previewContainer').style.display = 'none';
        }

        function loadCsvFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('csvInput').value = e.target.result;
                showStatus(`ğŸ“ å·²åŠ è½½æ–‡ä»¶: ${file.name}`, 'success');
            };
            reader.readAsText(file);
        }

        function loadJsonFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('jsonInput').value = e.target.result;
                showStatus(`ğŸ“ å·²åŠ è½½æ–‡ä»¶: ${file.name}`, 'success');
            };
            reader.readAsText(file);
        }

        function parseCsv(text, delimiter = ',', hasHeader = true, trimSpaces = true) {
            const lines = text.trim().split('\n');
            if (lines.length === 0) return [];
            
            const result = [];
            const headers = hasHeader ? parseCSVLine(lines[0], delimiter, trimSpaces) : null;
            const startIndex = hasHeader ? 1 : 0;
            
            for (let i = startIndex; i < lines.length; i++) {
                const values = parseCSVLine(lines[i], delimiter, trimSpaces);
                if (values.length === 0) continue;
                
                if (hasHeader && headers) {
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = values[index] || '';
                    });
                    result.push(obj);
                } else {
                    result.push(values);
                }
            }
            
            return result;
        }

        function parseCSVLine(line, delimiter, trim = true) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === delimiter && !inQuotes) {
                    result.push(trim ? current.trim() : current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(trim ? current.trim() : current);
            return result;
        }

        function convertCsvToJson() {
            const csvText = document.getElementById('csvInput').value.trim();
            if (!csvText) {
                showStatus('è¯·è¾“å…¥ CSV æ•°æ®', 'error');
                return;
            }
            
            try {
                const delimiter = document.getElementById('csvDelimiter').value;
                const hasHeader = document.getElementById('hasHeader').checked;
                const trimSpaces = document.getElementById('trimSpaces').checked;
                const format = document.getElementById('jsonFormat').value;
                
                const data = parseCsv(csvText, delimiter, hasHeader, trimSpaces);
                
                let output;
                if (format === 'object' && hasHeader) {
                    output = {
                        data: data,
                        count: data.length,
                        headers: Object.keys(data[0] || {})
                    };
                } else {
                    output = data;
                }
                
                document.getElementById('jsonOutput').value = JSON.stringify(output, null, 2);
                showStatus(`âœ… æˆåŠŸè½¬æ¢ ${data.length} è¡Œæ•°æ®`, 'success');
                
            } catch (error) {
                showStatus(`âŒ è½¬æ¢å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function convertJsonToCsv() {
            const jsonText = document.getElementById('jsonInput').value.trim();
            if (!jsonText) {
                showStatus('è¯·è¾“å…¥ JSON æ•°æ®', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(jsonText);
                const delimiter = document.getElementById('outputDelimiter').value;
                const includeHeader = document.getElementById('includeHeader').checked;
                const flattenNested = document.getElementById('flattenNested').checked;
                
                let csvData;
                if (Array.isArray(data)) {
                    csvData = data;
                } else if (data.data && Array.isArray(data.data)) {
                    csvData = data.data;
                } else {
                    csvData = [data];
                }
                
                if (csvData.length === 0) {
                    showStatus('JSON æ•°æ®ä¸ºç©º', 'error');
                    return;
                }
                
                // å¤„ç†åµŒå¥—å¯¹è±¡
                if (flattenNested) {
                    csvData = csvData.map(item => flattenObject(item));
                }
                
                // è·å–æ‰€æœ‰é”®å
                const allKeys = new Set();
                csvData.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        Object.keys(item).forEach(key => allKeys.add(key));
                    }
                });
                
                const headers = Array.from(allKeys);
                let csvOutput = '';
                
                // æ·»åŠ æ ‡é¢˜è¡Œ
                if (includeHeader && headers.length > 0) {
                    csvOutput += headers.map(header => escapeCSVField(header)).join(delimiter) + '\n';
                }
                
                // æ·»åŠ æ•°æ®è¡Œ
                csvData.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        const row = headers.map(header => {
                            const value = item[header];
                            return escapeCSVField(value !== undefined ? String(value) : '');
                        });
                        csvOutput += row.join(delimiter) + '\n';
                    } else {
                        csvOutput += escapeCSVField(String(item)) + '\n';
                    }
                });
                
                document.getElementById('csvOutput').value = csvOutput;
                showStatus(`âœ… æˆåŠŸè½¬æ¢ ${csvData.length} è¡Œæ•°æ®`, 'success');
                
            } catch (error) {
                showStatus(`âŒ è½¬æ¢å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function flattenObject(obj, prefix = '') {
            const flattened = {};
            
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const newKey = prefix ? `${prefix}.${key}` : key;
                    
                    if (typeof obj[key] === 'object' && obj[key] !== null && !Array.isArray(obj[key])) {
                        Object.assign(flattened, flattenObject(obj[key], newKey));
                    } else {
                        flattened[newKey] = obj[key];
                    }
                }
            }
            
            return flattened;
        }

        function escapeCSVField(field) {
            if (field.includes(',') || field.includes('"') || field.includes('\n')) {
                return '"' + field.replace(/"/g, '""') + '"';
            }
            return field;
        }

        function copyJsonOutput() {
            const output = document.getElementById('jsonOutput');
            if (!output.value) {
                showStatus('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
                return;
            }
            
            output.select();
            document.execCommand('copy');
            showStatus('ğŸ“‹ JSON æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
        }

        function copyCsvOutput() {
            const output = document.getElementById('csvOutput');
            if (!output.value) {
                showStatus('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
                return;
            }
            
            output.select();
            document.execCommand('copy');
            showStatus('ğŸ“‹ CSV æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
        }

        function downloadJson() {
            const output = document.getElementById('jsonOutput').value;
            if (!output) {
                showStatus('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹', 'error');
                return;
            }
            
            const blob = new Blob([output], { type: 'application/json' });
            downloadFile(blob, `converted_${new Date().getTime()}.json`);
            showStatus('ğŸ’¾ JSON æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼', 'success');
        }

        function downloadCsv() {
            const output = document.getElementById('csvOutput').value;
            if (!output) {
                showStatus('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹', 'error');
                return;
            }
            
            const blob = new Blob([output], { type: 'text/csv;charset=utf-8;' });
            downloadFile(blob, `converted_${new Date().getTime()}.csv`);
            showStatus('ğŸ’¾ CSV æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼', 'success');
        }

        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function previewData(type) {
            const container = document.getElementById('previewContainer');
            let data;
            
            try {
                if (type === 'json') {
                    const jsonText = document.getElementById('jsonOutput').value;
                    if (!jsonText) {
                        showStatus('è¯·å…ˆè½¬æ¢æ•°æ®', 'error');
                        return;
                    }
                    data = JSON.parse(jsonText);
                    if (data.data && Array.isArray(data.data)) {
                        data = data.data;
                    }
                } else {
                    const csvText = document.getElementById('csvOutput').value;
                    if (!csvText) {
                        showStatus('è¯·å…ˆè½¬æ¢æ•°æ®', 'error');
                        return;
                    }
                    const delimiter = document.getElementById('outputDelimiter').value;
                    data = parseCsv(csvText, delimiter, true, true);
                }
                
                if (!Array.isArray(data) || data.length === 0) {
                    showStatus('æ²¡æœ‰å¯é¢„è§ˆçš„æ•°æ®', 'error');
                    return;
                }
                
                const table = createPreviewTable(data);
                container.innerHTML = table;
                container.style.display = 'block';
                showStatus('ğŸ‘ï¸ æ•°æ®é¢„è§ˆå·²ç”Ÿæˆ', 'success');
                
            } catch (error) {
                showStatus(`âŒ é¢„è§ˆå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function createPreviewTable(data) {
            if (data.length === 0) return '<p>æ²¡æœ‰æ•°æ®</p>';
            
            const headers = Object.keys(data[0]);
            let html = '<table><thead><tr>';
            
            headers.forEach(header => {
                html += `<th>${header}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            data.slice(0, 100).forEach(row => { // åªæ˜¾ç¤ºå‰100è¡Œ
                html += '<tr>';
                headers.forEach(header => {
                    const value = row[header] !== undefined ? String(row[header]) : '';
                    html += `<td>${value.length > 50 ? value.substring(0, 50) + '...' : value}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            
            if (data.length > 100) {
                html += `<p style="text-align: center; margin: 10px; color: #6c757d;">æ˜¾ç¤ºå‰ 100 è¡Œï¼Œå…± ${data.length} è¡Œæ•°æ®</p>`;
            }
            
            return html;
        }

        function clearCsvInput() {
            document.getElementById('csvInput').value = '';
            document.getElementById('jsonOutput').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            showStatus('ğŸ—‘ï¸ å·²æ¸…ç©º CSV è¾“å…¥', 'info');
        }

        function clearJsonInput() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('csvOutput').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            showStatus('ğŸ—‘ï¸ å·²æ¸…ç©º JSON è¾“å…¥', 'info');
        }

        // ç¤ºä¾‹æ•°æ®åŠ è½½
        window.addEventListener('load', function() {
            // CSV ç¤ºä¾‹
            const csvExample = `å§“å,å¹´é¾„,åŸå¸‚,èŒä¸š,è–ªèµ„
å¼ ä¸‰,28,åŒ—äº¬,è½¯ä»¶å·¥ç¨‹å¸ˆ,15000
æå››,32,ä¸Šæµ·,UIè®¾è®¡å¸ˆ,12000
ç‹äº”,25,å¹¿å·,äº§å“ç»ç†,18000
èµµå…­,29,æ·±åœ³,æ•°æ®åˆ†æå¸ˆ,14000`;
            
            document.getElementById('csvInput').value = csvExample;
            
            // JSON ç¤ºä¾‹
            const jsonExample = [
                {
                    "å§“å": "å¼ ä¸‰",
                    "å¹´é¾„": 28,
                    "åŸå¸‚": "åŒ—äº¬",
                    "èŒä¸š": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
                    "æŠ€èƒ½": ["JavaScript", "Python", "Java"]
                },
                {
                    "å§“å": "æå››",
                    "å¹´é¾„": 32,
                    "åŸå¸‚": "ä¸Šæµ·",
                    "èŒä¸š": "UIè®¾è®¡å¸ˆ",
                    "æŠ€èƒ½": ["Photoshop", "Sketch", "Figma"]
                },
                {
                    "å§“å": "ç‹äº”",
                    "å¹´é¾„": 25,
                    "åŸå¸‚": "å¹¿å·",
                    "èŒä¸š": "äº§å“ç»ç†",
                    "æŠ€èƒ½": ["Axure", "Visio", "éœ€æ±‚åˆ†æ"]
                }
            ];
            
            document.getElementById('jsonInput').value = JSON.stringify(jsonExample, null, 2);
        });
    
                return input;
            }

            displayResult(result) {
                document.getElementById('resultContent').textContent = result;
            }

            clear() {
                document.getElementById('input').value = '';
                document.getElementById('resultContent').textContent = 'å¤„ç†ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            }

            copyResult() {
                const result = document.getElementById('resultContent').textContent;
                if (result && result !== 'å¤„ç†ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...') {
                    ToolUtils.copyToClipboard(result);
                } else {
                    ToolUtils.showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'warning');
                }
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new ToolApp();
        });
    </script>
</body>
</html>
