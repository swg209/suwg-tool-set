<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV/JSON ËΩ¨Êç¢Âô® - AIÂ∑•ÂÖ∑ÈõÜ</title>
    <meta name="description" content="CSV/JSON ËΩ¨Êç¢Âô®">
    
    <!-- Ê†∑ÂºèÊñá‰ª∂ -->
    <link rel="stylesheet" href="../../shared/css/common.css">
    
    <!-- Â∑•ÂÖ∑ÁâπÂÆöÊ†∑Âºè -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            min-height: 100vh;
            padding: var(--spacing-lg);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #0984e3;
            border-bottom: 3px solid #0984e3;
        }

        .tab:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .converter-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-box, .output-box {
            background: #f8f9fa;
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .box-header h3 {
            color: #495057;
            font-size: 1.3em;
        }

        .file-upload {
            position: relative;
            display: inline-block;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-btn {
            padding: 8px 15px;
            background: #6c757d;
            color: white;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-upload-btn:hover {
            background: #5a6268;
        }

        textarea {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: var(--radius-md);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #0984e3;
        }

        .controls {
            margin: var(--spacing-lg) 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
        }

        .control-group input, .control-group select {
            padding: 6px 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .preview-table {
            max-height: 300px;
            overflow: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-top: 15px;
        }

        .preview-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .preview-table th,
        .preview-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            font-size: 13px;
        }

        .preview-table th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .preview-table tr:hover {
            background: #f8f9fa;
        }

        .footer {
            text-align: center;
            padding: var(--spacing-lg);
            background: #f8f9fa;
            color: #6c757d;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .converter-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tab-content {
                padding: var(--spacing-lg);
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="tool-container">
        <!-- Â∑•ÂÖ∑Â§¥ÈÉ® -->
        <header class="tool-header">
            <div class="tool-header-content">
                <a href="../../index.html" class="back-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M10 4l-4 4 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    ËøîÂõûÂ∑•ÂÖ∑ÈõÜ
                </a>
                
                <div class="tool-title">
                    <h1>CSV/JSON ËΩ¨Êç¢Âô®</h1>
                    <p class="tool-subtitle">CSV/JSON ËΩ¨Êç¢Âô®</p>
                </div>
                
                <button class="theme-toggle" id="themeToggle" aria-label="ÂàáÊç¢‰∏ªÈ¢ò">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2"/>
                        <path d="M10 2v2M10 16v2M18 10h-2M4 10H2M15.66 4.34l-1.41 1.41M5.75 14.25l-1.41 1.41M15.66 15.66l-1.41-1.41M5.75 5.75L4.34 4.34" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Â∑•ÂÖ∑‰∏ªÂÜÖÂÆπ -->
        <main class="tool-main">
            <div class="tool-card">
                <div class="tool-section">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Â∑•ÂÖ∑ÂäüËÉΩ
                    </h2>
                    
                    
            <div class="tool-card">
                <div class="tool-section">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        CSV/JSON ËΩ¨Êç¢Âô®
                    </h2>
                    <div class="container">
        <div class="header">
            <h1>üîÑ CSV/JSON ËΩ¨Êç¢Âô®</h1>
            <p>ÂÆ¢Êà∑Á´ØËß£Êûê CSV Êñá‰ª∂Âπ∂ËΩ¨Êç¢‰∏∫ JSONÔºåÊàñÂèç‰πã</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('csv-to-json')">üìä CSV ‚Üí JSON</button>
            <button class="tab" onclick="switchTab('json-to-csv')">üìã JSON ‚Üí CSV</button>
        </div>

        <!-- CSV to JSON Tab -->
        <div id="csv-to-json" class="tab-content active">
            <div class="converter-section">
                <div class="input-box">
                    <div class="box-header">
                        <h3>CSV ËæìÂÖ•</h3>
                        <div class="file-upload">
                            <input type="file" id="csvFile" accept=".csv" onchange="loadCsvFile(this)">
                            <div class="file-upload-btn">üìÅ ÈÄâÊã©Êñá‰ª∂</div>
                        </div>
                    </div>
                    <textarea id="csvInput" placeholder="Á≤òË¥¥ÊÇ®ÁöÑ CSV Êï∞ÊçÆÔºåÊàñ‰ΩøÁî®‰∏äÊñπÊåâÈíÆÈÄâÊã©Êñá‰ª∂Ôºö

ÂßìÂêç,Âπ¥ÈæÑ,ÂüéÂ∏Ç,ËÅå‰∏ö
Âº†‰∏â,28,Âåó‰∫¨,Â∑•Á®ãÂ∏à
ÊùéÂõõ,32,‰∏äÊµ∑,ËÆæËÆ°Â∏à
Áéã‰∫î,25,ÂπøÂ∑û,‰∫ßÂìÅÁªèÁêÜ"></textarea>
                    
                    <div class="controls">
                        <div class="control-group">
                            <label>ÂàÜÈöîÁ¨¶:</label>
                            <select id="csvDelimiter">
                                <option value=",">ÈÄóÂè∑ (,)</option>
                                <option value=";">ÂàÜÂè∑ (;)</option>
                                <option value="\t">Âà∂Ë°®Á¨¶ (\t)</option>
                                <option value="|">Á´ñÁ∫ø (|)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="hasHeader" checked>
                            <label for="hasHeader">ÂåÖÂê´Ê†áÈ¢òË°å</label>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="trimSpaces" checked>
                            <label for="trimSpaces">ÂéªÈô§Á©∫Ê†º</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn-primary" onclick="convertCsvToJson()">üîÑ ËΩ¨Êç¢‰∏∫ JSON</button>
                        <button class="btn-secondary" onclick="clearCsvInput()">üóëÔ∏è Ê∏ÖÁ©∫</button>
                    </div>
                </div>

                <div class="output-box">
                    <div class="box-header">
                        <h3>JSON ËæìÂá∫</h3>
                        <div class="control-group">
                            <label>Ê†ºÂºè:</label>
                            <select id="jsonFormat">
                                <option value="array">Êï∞ÁªÑÊ†ºÂºè</option>
                                <option value="object">ÂØπË±°Ê†ºÂºè</option>
                            </select>
                        </div>
                    </div>
                    <textarea id="jsonOutput" placeholder="ËΩ¨Êç¢ÂêéÁöÑ JSON Êï∞ÊçÆÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå..." readonly></textarea>
                    
                    <div class="btn-group">
                        <button class="btn-success" onclick="copyJsonOutput()">üìã Â§çÂà∂</button>
                        <button class="btn-warning" onclick="downloadJson()">üíæ ‰∏ãËΩΩ</button>
                        <button class="btn-secondary" onclick="previewData('json')">üëÅÔ∏è È¢ÑËßà</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- JSON to CSV Tab -->
        <div id="json-to-csv" class="tab-content">
            <div class="converter-section">
                <div class="input-box">
                    <div class="box-header">
                        <h3>JSON ËæìÂÖ•</h3>
                        <div class="file-upload">
                            <input type="file" id="jsonFile" accept=".json" onchange="loadJsonFile(this)">
                            <div class="file-upload-btn">üìÅ ÈÄâÊã©Êñá‰ª∂</div>
                        </div>
                    </div>
                    <textarea id="jsonInput" placeholder="Á≤òË¥¥ÊÇ®ÁöÑ JSON Êï∞ÊçÆÔºåÊàñ‰ΩøÁî®‰∏äÊñπÊåâÈíÆÈÄâÊã©Êñá‰ª∂Ôºö

[
  {
    &quot;ÂßìÂêç&quot;: &quot;Âº†‰∏â&quot;,
    &quot;Âπ¥ÈæÑ&quot;: 28,
    &quot;ÂüéÂ∏Ç&quot;: &quot;Âåó‰∫¨&quot;,
    &quot;ËÅå‰∏ö&quot;: &quot;Â∑•Á®ãÂ∏à&quot;
  },
  {
    &quot;ÂßìÂêç&quot;: &quot;ÊùéÂõõ&quot;,
    &quot;Âπ¥ÈæÑ&quot;: 32,
    &quot;ÂüéÂ∏Ç&quot;: &quot;‰∏äÊµ∑&quot;,
    &quot;ËÅå‰∏ö&quot;: &quot;ËÆæËÆ°Â∏à&quot;
  }
]"></textarea>
                    
                    <div class="controls">
                        <div class="control-group">
                            <label>ËæìÂá∫ÂàÜÈöîÁ¨¶:</label>
                            <select id="outputDelimiter">
                                <option value=",">ÈÄóÂè∑ (,)</option>
                                <option value=";">ÂàÜÂè∑ (;)</option>
                                <option value="\t">Âà∂Ë°®Á¨¶ (\t)</option>
                                <option value="|">Á´ñÁ∫ø (|)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="includeHeader" checked>
                            <label for="includeHeader">ÂåÖÂê´Ê†áÈ¢òË°å</label>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="flattenNested">
                            <label for="flattenNested">Â±ïÂºÄÂµåÂ•óÂØπË±°</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn-primary" onclick="convertJsonToCsv()">üîÑ ËΩ¨Êç¢‰∏∫ CSV</button>
                        <button class="btn-secondary" onclick="clearJsonInput()">üóëÔ∏è Ê∏ÖÁ©∫</button>
                    </div>
                </div>

                <div class="output-box">
                    <div class="box-header">
                        <h3>CSV ËæìÂá∫</h3>
                    </div>
                    <textarea id="csvOutput" placeholder="ËΩ¨Êç¢ÂêéÁöÑ CSV Êï∞ÊçÆÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå..." readonly></textarea>
                    
                    <div class="btn-group">
                        <button class="btn-success" onclick="copyCsvOutput()">üìã Â§çÂà∂</button>
                        <button class="btn-warning" onclick="downloadCsv()">üíæ ‰∏ãËΩΩ</button>
                        <button class="btn-secondary" onclick="previewData('csv')">üëÅÔ∏è È¢ÑËßà</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="status" class="status" style="display: none;"></div>
        <div id="previewContainer" class="preview-table" style="display: none;"></div>

        <div class="footer">
            <p>üí° ÊîØÊåÅÂ§öÁßçÂàÜÈöîÁ¨¶„ÄÅÂµåÂ•óÂØπË±°Â±ïÂºÄ„ÄÅÊï∞ÊçÆÈ¢ÑËßàÁ≠âÂäüËÉΩ</p>
            <p>ËÑöÊ≥®ÔºöÂ∞èËãèË∂£Á†îAI - ËÆ©Êï∞ÊçÆÊ†ºÂºèËΩ¨Êç¢ÂèòÂæóÁÆÄÂçïÈ´òÊïà</p>
        </div>
    </div>

    
                </div>
            </div>
                    <!-- ÁªìÊûúÊòæÁ§∫Âå∫Âüü -->
                    <div class="result-display" id="result">
                        <pre id="resultContent">Â§ÑÁêÜÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...</pre>
                    </div>
                </div>
            </div>
        </main>

        <!-- Â∑•ÂÖ∑È°µËÑö -->
        <footer class="tool-footer">
            <p>Áî± <a href="../../index.html">AIÂ∑•ÂÖ∑ÈõÜ</a> Êèê‰æõ | ÂéüÂàõÂ∑•ÂÖ∑</p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="../../shared/js/utils.js"></script>
    <script>
        // Â∑•ÂÖ∑ÁâπÂÆöÁöÑJavaScript‰ª£Á†Å
        class ToolApp {
            constructor() {
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('processBtn').addEventListener('click', () => this.process());
                document.getElementById('clearBtn').addEventListener('click', () => this.clear());
                document.getElementById('copyBtn').addEventListener('click', () => this.copyResult());
                
                // ÂÆûÊó∂Â§ÑÁêÜÔºàÂèØÈÄâÔºâ
                document.getElementById('input').addEventListener('input', 
                    ToolUtils.debounce(() => this.process(), 300)
                );
            }

            process() {
                const input = document.getElementById('input').value;
                const result = this.processInput(input);
                this.displayResult(result);
            }

            processInput(input) {
                
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchTab(tabId) {
            // ÈöêËóèÊâÄÊúâÊ†áÁ≠æÂÜÖÂÆπ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÁßªÈô§ÊâÄÊúâÊ†áÁ≠æÁöÑÊ¥ªÂä®Áä∂ÊÄÅ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊ†áÁ≠æÂÜÖÂÆπ
            document.getElementById(tabId).classList.add('active');
            
            // ÊøÄÊ¥ªÈÄâ‰∏≠ÁöÑÊ†áÁ≠æ
            event.target.classList.add('active');
            
            // ÈöêËóèÈ¢ÑËßà
            document.getElementById('previewContainer').style.display = 'none';
        }

        function loadCsvFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('csvInput').value = e.target.result;
                showStatus(`üìÅ Â∑≤Âä†ËΩΩÊñá‰ª∂: ${file.name}`, 'success');
            };
            reader.readAsText(file);
        }

        function loadJsonFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('jsonInput').value = e.target.result;
                showStatus(`üìÅ Â∑≤Âä†ËΩΩÊñá‰ª∂: ${file.name}`, 'success');
            };
            reader.readAsText(file);
        }

        function parseCsv(text, delimiter = ',', hasHeader = true, trimSpaces = true) {
            const lines = text.trim().split('\n');
            if (lines.length === 0) return [];
            
            const result = [];
            const headers = hasHeader ? parseCSVLine(lines[0], delimiter, trimSpaces) : null;
            const startIndex = hasHeader ? 1 : 0;
            
            for (let i = startIndex; i < lines.length; i++) {
                const values = parseCSVLine(lines[i], delimiter, trimSpaces);
                if (values.length === 0) continue;
                
                if (hasHeader && headers) {
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = values[index] || '';
                    });
                    result.push(obj);
                } else {
                    result.push(values);
                }
            }
            
            return result;
        }

        function parseCSVLine(line, delimiter, trim = true) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === delimiter && !inQuotes) {
                    result.push(trim ? current.trim() : current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(trim ? current.trim() : current);
            return result;
        }

        function convertCsvToJson() {
            const csvText = document.getElementById('csvInput').value.trim();
            if (!csvText) {
                showStatus('ËØ∑ËæìÂÖ• CSV Êï∞ÊçÆ', 'error');
                return;
            }
            
            try {
                const delimiter = document.getElementById('csvDelimiter').value;
                const hasHeader = document.getElementById('hasHeader').checked;
                const trimSpaces = document.getElementById('trimSpaces').checked;
                const format = document.getElementById('jsonFormat').value;
                
                const data = parseCsv(csvText, delimiter, hasHeader, trimSpaces);
                
                let output;
                if (format === 'object' && hasHeader) {
                    output = {
                        data: data,
                        count: data.length,
                        headers: Object.keys(data[0] || {})
                    };
                } else {
                    output = data;
                }
                
                document.getElementById('jsonOutput').value = JSON.stringify(output, null, 2);
                showStatus(`‚úÖ ÊàêÂäüËΩ¨Êç¢ ${data.length} Ë°åÊï∞ÊçÆ`, 'success');
                
            } catch (error) {
                showStatus(`‚ùå ËΩ¨Êç¢Â§±Ë¥•: ${error.message}`, 'error');
            }
        }

        function convertJsonToCsv() {
            const jsonText = document.getElementById('jsonInput').value.trim();
            if (!jsonText) {
                showStatus('ËØ∑ËæìÂÖ• JSON Êï∞ÊçÆ', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(jsonText);
                const delimiter = document.getElementById('outputDelimiter').value;
                const includeHeader = document.getElementById('includeHeader').checked;
                const flattenNested = document.getElementById('flattenNested').checked;
                
                let csvData;
                if (Array.isArray(data)) {
                    csvData = data;
                } else if (data.data && Array.isArray(data.data)) {
                    csvData = data.data;
                } else {
                    csvData = [data];
                }
                
                if (csvData.length === 0) {
                    showStatus('JSON Êï∞ÊçÆ‰∏∫Á©∫', 'error');
                    return;
                }
                
                // Â§ÑÁêÜÂµåÂ•óÂØπË±°
                if (flattenNested) {
                    csvData = csvData.map(item => flattenObject(item));
                }
                
                // Ëé∑ÂèñÊâÄÊúâÈîÆÂêç
                const allKeys = new Set();
                csvData.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        Object.keys(item).forEach(key => allKeys.add(key));
                    }
                });
                
                const headers = Array.from(allKeys);
                let csvOutput = '';
                
                // Ê∑ªÂä†Ê†áÈ¢òË°å
                if (includeHeader && headers.length > 0) {
                    csvOutput += headers.map(header => escapeCSVField(header)).join(delimiter) + '\n';
                }
                
                // Ê∑ªÂä†Êï∞ÊçÆË°å
                csvData.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        const row = headers.map(header => {
                            const value = item[header];
                            return escapeCSVField(value !== undefined ? String(value) : '');
                        });
                        csvOutput += row.join(delimiter) + '\n';
                    } else {
                        csvOutput += escapeCSVField(String(item)) + '\n';
                    }
                });
                
                document.getElementById('csvOutput').value = csvOutput;
                showStatus(`‚úÖ ÊàêÂäüËΩ¨Êç¢ ${csvData.length} Ë°åÊï∞ÊçÆ`, 'success');
                
            } catch (error) {
                showStatus(`‚ùå ËΩ¨Êç¢Â§±Ë¥•: ${error.message}`, 'error');
            }
        }

        function flattenObject(obj, prefix = '') {
            const flattened = {};
            
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const newKey = prefix ? `${prefix}.${key}` : key;
                    
                    if (typeof obj[key] === 'object' && obj[key] !== null && !Array.isArray(obj[key])) {
                        Object.assign(flattened, flattenObject(obj[key], newKey));
                    } else {
                        flattened[newKey] = obj[key];
                    }
                }
            }
            
            return flattened;
        }

        function escapeCSVField(field) {
            if (field.includes(',') || field.includes('"') || field.includes('\n')) {
                return '"' + field.replace(/"/g, '""') + '"';
            }
            return field;
        }

        function copyJsonOutput() {
            const output = document.getElementById('jsonOutput');
            if (!output.value) {
                showStatus('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ', 'error');
                return;
            }
            
            output.select();
            document.execCommand('copy');
            showStatus('üìã JSON Êï∞ÊçÆÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ', 'success');
        }

        function copyCsvOutput() {
            const output = document.getElementById('csvOutput');
            if (!output.value) {
                showStatus('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ', 'error');
                return;
            }
            
            output.select();
            document.execCommand('copy');
            showStatus('üìã CSV Êï∞ÊçÆÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ', 'success');
        }

        function downloadJson() {
            const output = document.getElementById('jsonOutput').value;
            if (!output) {
                showStatus('Ê≤°ÊúâÂèØ‰∏ãËΩΩÁöÑÂÜÖÂÆπ', 'error');
                return;
            }
            
            const blob = new Blob([output], { type: 'application/json' });
            downloadFile(blob, `converted_${new Date().getTime()}.json`);
            showStatus('üíæ JSON Êñá‰ª∂‰∏ãËΩΩÊàêÂäüÔºÅ', 'success');
        }

        function downloadCsv() {
            const output = document.getElementById('csvOutput').value;
            if (!output) {
                showStatus('Ê≤°ÊúâÂèØ‰∏ãËΩΩÁöÑÂÜÖÂÆπ', 'error');
                return;
            }
            
            const blob = new Blob([output], { type: 'text/csv;charset=utf-8;' });
            downloadFile(blob, `converted_${new Date().getTime()}.csv`);
            showStatus('üíæ CSV Êñá‰ª∂‰∏ãËΩΩÊàêÂäüÔºÅ', 'success');
        }

        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function previewData(type) {
            const container = document.getElementById('previewContainer');
            let data;
            
            try {
                if (type === 'json') {
                    const jsonText = document.getElementById('jsonOutput').value;
                    if (!jsonText) {
                        showStatus('ËØ∑ÂÖàËΩ¨Êç¢Êï∞ÊçÆ', 'error');
                        return;
                    }
                    data = JSON.parse(jsonText);
                    if (data.data && Array.isArray(data.data)) {
                        data = data.data;
                    }
                } else {
                    const csvText = document.getElementById('csvOutput').value;
                    if (!csvText) {
                        showStatus('ËØ∑ÂÖàËΩ¨Êç¢Êï∞ÊçÆ', 'error');
                        return;
                    }
                    const delimiter = document.getElementById('outputDelimiter').value;
                    data = parseCsv(csvText, delimiter, true, true);
                }
                
                if (!Array.isArray(data) || data.length === 0) {
                    showStatus('Ê≤°ÊúâÂèØÈ¢ÑËßàÁöÑÊï∞ÊçÆ', 'error');
                    return;
                }
                
                const table = createPreviewTable(data);
                container.innerHTML = table;
                container.style.display = 'block';
                showStatus('üëÅÔ∏è Êï∞ÊçÆÈ¢ÑËßàÂ∑≤ÁîüÊàê', 'success');
                
            } catch (error) {
                showStatus(`‚ùå È¢ÑËßàÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        function createPreviewTable(data) {
            if (data.length === 0) return '<p>Ê≤°ÊúâÊï∞ÊçÆ</p>';
            
            const headers = Object.keys(data[0]);
            let html = '<table><thead><tr>';
            
            headers.forEach(header => {
                html += `<th>${header}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            data.slice(0, 100).forEach(row => { // Âè™ÊòæÁ§∫Ââç100Ë°å
                html += '<tr>';
                headers.forEach(header => {
                    const value = row[header] !== undefined ? String(row[header]) : '';
                    html += `<td>${value.length > 50 ? value.substring(0, 50) + '...' : value}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            
            if (data.length > 100) {
                html += `<p style="text-align: center; margin: 10px; color: #6c757d;">ÊòæÁ§∫Ââç 100 Ë°åÔºåÂÖ± ${data.length} Ë°åÊï∞ÊçÆ</p>`;
            }
            
            return html;
        }

        function clearCsvInput() {
            document.getElementById('csvInput').value = '';
            document.getElementById('jsonOutput').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            showStatus('üóëÔ∏è Â∑≤Ê∏ÖÁ©∫ CSV ËæìÂÖ•', 'info');
        }

        function clearJsonInput() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('csvOutput').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            showStatus('üóëÔ∏è Â∑≤Ê∏ÖÁ©∫ JSON ËæìÂÖ•', 'info');
        }

        // Á§∫‰æãÊï∞ÊçÆÂä†ËΩΩ
        window.addEventListener('load', function() {
            // CSV Á§∫‰æã
            const csvExample = `ÂßìÂêç,Âπ¥ÈæÑ,ÂüéÂ∏Ç,ËÅå‰∏ö,Ëñ™ËµÑ
Âº†‰∏â,28,Âåó‰∫¨,ËΩØ‰ª∂Â∑•Á®ãÂ∏à,15000
ÊùéÂõõ,32,‰∏äÊµ∑,UIËÆæËÆ°Â∏à,12000
Áéã‰∫î,25,ÂπøÂ∑û,‰∫ßÂìÅÁªèÁêÜ,18000
ËµµÂÖ≠,29,Ê∑±Âú≥,Êï∞ÊçÆÂàÜÊûêÂ∏à,14000`;
            
            document.getElementById('csvInput').value = csvExample;
            
            // JSON Á§∫‰æã
            const jsonExample = [
                {
                    "ÂßìÂêç": "Âº†‰∏â",
                    "Âπ¥ÈæÑ": 28,
                    "ÂüéÂ∏Ç": "Âåó‰∫¨",
                    "ËÅå‰∏ö": "ËΩØ‰ª∂Â∑•Á®ãÂ∏à",
                    "ÊäÄËÉΩ": ["JavaScript", "Python", "Java"]
                },
                {
                    "ÂßìÂêç": "ÊùéÂõõ",
                    "Âπ¥ÈæÑ": 32,
                    "ÂüéÂ∏Ç": "‰∏äÊµ∑",
                    "ËÅå‰∏ö": "UIËÆæËÆ°Â∏à",
                    "ÊäÄËÉΩ": ["Photoshop", "Sketch", "Figma"]
                },
                {
                    "ÂßìÂêç": "Áéã‰∫î",
                    "Âπ¥ÈæÑ": 25,
                    "ÂüéÂ∏Ç": "ÂπøÂ∑û",
                    "ËÅå‰∏ö": "‰∫ßÂìÅÁªèÁêÜ",
                    "ÊäÄËÉΩ": ["Axure", "Visio", "ÈúÄÊ±ÇÂàÜÊûê"]
                }
            ];
            
            document.getElementById('jsonInput').value = JSON.stringify(jsonExample, null, 2);
        });
    
                return input;
            }

            displayResult(result) {
                document.getElementById('resultContent').textContent = result;
            }

            clear() {
                document.getElementById('input').value = '';
                document.getElementById('resultContent').textContent = 'Â§ÑÁêÜÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...';
            }

            copyResult() {
                const result = document.getElementById('resultContent').textContent;
                if (result && result !== 'Â§ÑÁêÜÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...') {
                    ToolUtils.copyToClipboard(result);
                } else {
                    ToolUtils.showToast('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ', 'warning');
                }
            }
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', () => {
            new ToolApp();
        });
    </script>
</body>
</html>
