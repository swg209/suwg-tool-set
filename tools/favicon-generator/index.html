<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favicon 生成器 - AI工具集</title>
    <meta name="description" content="Favicon 生成器">
    
    <!-- 样式文件 -->
    <link rel="stylesheet" href="../../shared/css/common.css">
    
    <!-- 工具特定样式 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: var(--spacing-lg);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            border-radius: var(--radius-md) 10px 0 0;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
            background: white;
            border-radius: 0 0 10px 10px;
            border: 2px solid #dee2e6;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .generator-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-section, .preview-section {
            background: #f8f9fa;
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .input-section h3, .preview-section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .text-generator {
            margin-bottom: 25px;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            font-size: 48px;
            text-align: center;
            border: 2px solid #dee2e6;
            border-radius: var(--radius-md);
            margin-bottom: 15px;
            font-weight: bold;
            background: white;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .font-selector {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .color-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .color-group {
            text-align: center;
        }

        .color-group label {
            display: block;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .color-input {
            width: 100%;
            height: 50px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: var(--radius-md);
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-icon {
            font-size: 3em;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .upload-hint {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            padding: var(--spacing-md) 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .size-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .size-btn {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
        }

        .size-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .size-btn:hover:not(.active) {
            border-color: #adb5bd;
            background: #f8f9fa;
        }

        .canvas-container {
            position: relative;
            display: inline-block;
            margin: var(--spacing-md);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-card);
        }

        .canvas-size-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px;
            font-size: 11px;
            text-align: center;
        }

        canvas {
            display: block;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .download-section {
            background: #f8f9fa;
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .download-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .format-option {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .format-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .format-option:hover:not(.selected) {
            border-color: #adb5bd;
        }

        .format-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
        }

        .format-desc {
            font-size: 0.9em;
            color: #6c757d;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin: var(--spacing-lg) 0;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .footer {
            text-align: center;
            padding: var(--spacing-lg);
            background: #f8f9fa;
            color: #6c757d;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .generator-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .color-controls {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: var(--spacing-lg);
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .text-input {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div class="tool-container">
        <!-- 工具头部 -->
        <header class="tool-header">
            <div class="tool-header-content">
                <a href="../../index.html" class="back-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M10 4l-4 4 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    返回工具集
                </a>
                
                <div class="tool-title">
                    <h1>Favicon 生成器</h1>
                    <p class="tool-subtitle">Favicon 生成器</p>
                </div>
                
                <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2"/>
                        <path d="M10 2v2M10 16v2M18 10h-2M4 10H2M15.66 4.34l-1.41 1.41M5.75 14.25l-1.41 1.41M15.66 15.66l-1.41-1.41M5.75 5.75L4.34 4.34" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- 工具主内容 -->
        <main class="tool-main">
            <div class="tool-card">
                <div class="tool-section">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        工具功能
                    </h2>
                    
                    
            <div class="tool-card">
                <div class="tool-section">
                    <h2>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Favicon 生成器
                    </h2>
                    <div class="container">
        <div class="header">
            <h1>🎨 Favicon 生成器</h1>
            <p>输入文字或上传小图，生成简单的 Favicon（ico 或 png）</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('text-generator')">✏️ 文字生成</button>
                <button class="tab" onclick="switchTab('image-upload')">🖼️ 图片上传</button>
            </div>

            <!-- 文字生成标签 -->
            <div id="text-generator" class="tab-content active">
                <div class="generator-section">
                    <div class="input-section">
                        <h3>文字设置</h3>
                        <div class="text-generator">
                            <input type="text" id="faviconText" class="text-input" placeholder="A" maxlength="3" value="A">
                            
                            <select id="fontFamily" class="font-selector">
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="Helvetica, sans-serif">Helvetica</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="Times New Roman, serif">Times New Roman</option>
                                <option value="Courier New, monospace">Courier New</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                                <option value="Impact, sans-serif">Impact</option>
                                <option value="Comic Sans MS, cursive">Comic Sans MS</option>
                            </select>
                            
                            <div class="color-controls">
                                <div class="color-group">
                                    <label>背景颜色</label>
                                    <input type="color" id="backgroundColor" class="color-input" value="#667eea">
                                </div>
                                <div class="color-group">
                                    <label>文字颜色</label>
                                    <input type="color" id="textColor" class="color-input" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="btn-group">
                                <button class="btn-primary" onclick="generateTextFavicon()">🎨 生成 Favicon</button>
                                <button class="btn-secondary" onclick="randomColors()">🎲 随机配色</button>
                            </div>
                        </div>
                    </div>

                    <div class="preview-section">
                        <h3>预览效果</h3>
                        <div id="textPreviewContainer">
                            <!-- 动态生成预览 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 图片上传标签 -->
            <div id="image-upload" class="tab-content">
                <div class="generator-section">
                    <div class="input-section">
                        <h3>图片上传</h3>
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">🖼️</div>
                            <div class="upload-text">拖拽图片到这里或点击选择</div>
                            <div class="upload-hint">支持 JPG、PNG、SVG 格式</div>
                            <input type="file" id="imageInput" class="file-input" accept="image/*">
                            <button class="upload-btn" onclick="document.getElementById('imageInput').click()">📁 选择图片</button>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-primary" onclick="generateImageFavicon()">🎨 生成 Favicon</button>
                            <button class="btn-secondary" onclick="clearImage()">🗑️ 清除图片</button>
                        </div>
                    </div>

                    <div class="preview-section">
                        <h3>预览效果</h3>
                        <div id="imagePreviewContainer">
                            <!-- 动态生成预览 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 尺寸选择 -->
            <div class="size-controls">
                <div class="size-btn active" data-size="16">16×16</div>
                <div class="size-btn active" data-size="32">32×32</div>
                <div class="size-btn active" data-size="48">48×48</div>
                <div class="size-btn active" data-size="64">64×64</div>
                <div class="size-btn" data-size="128">128×128</div>
                <div class="size-btn" data-size="256">256×256</div>
            </div>

            <!-- 下载区域 -->
            <div class="download-section">
                <h3>下载选项</h3>
                <div class="download-options">
                    <div class="format-option selected" data-format="ico">
                        <div class="format-title">ICO 格式</div>
                        <div class="format-desc">标准 Favicon 格式，支持多尺寸</div>
                    </div>
                    <div class="format-option" data-format="png">
                        <div class="format-title">PNG 格式</div>
                        <div class="format-desc">高质量图片格式，支持透明背景</div>
                    </div>
                    <div class="format-option" data-format="svg">
                        <div class="format-title">SVG 格式</div>
                        <div class="format-desc">矢量格式，无限缩放不失真</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn-success" onclick="downloadFavicons()" id="downloadBtn" disabled>💾 下载 Favicon</button>
                    <button class="btn-secondary" onclick="downloadAll()">📦 下载全部尺寸</button>
                </div>
            </div>

            <div id="status" class="status" style="display: none;"></div>
        </div>

        <div class="footer">
            <p>💡 支持多尺寸生成、多格式输出、实时预览</p>
            <p>脚注：小苏趣研AI - 让 Favicon 制作变得简单高效</p>
        </div>
    </div>

    
                </div>
            </div>
                    <!-- 结果显示区域 -->
                    <div class="result-display" id="result">
                        <pre id="resultContent">处理结果将在这里显示...</pre>
                    </div>
                </div>
            </div>
        </main>

        <!-- 工具页脚 -->
        <footer class="tool-footer">
            <p>由 <a href="../../index.html">AI工具集</a> 提供 | 原创工具</p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="../../shared/js/utils.js"></script>
    <script>
        // 工具特定的JavaScript代码
        class ToolApp {
            constructor() {
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('processBtn').addEventListener('click', () => this.process());
                document.getElementById('clearBtn').addEventListener('click', () => this.clear());
                document.getElementById('copyBtn').addEventListener('click', () => this.copyResult());
                
                // 实时处理（可选）
                document.getElementById('input').addEventListener('input', 
                    ToolUtils.debounce(() => this.process(), 300)
                );
            }

            process() {
                const input = document.getElementById('input').value;
                const result = this.processInput(input);
                this.displayResult(result);
            }

            processInput(input) {
                
        let currentCanvases = {};
        let uploadedImage = null;

        const faviconSizes = [16, 32, 48, 64, 128, 256];
        const selectedSizes = [16, 32, 48, 64];

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchTab(tabId) {
            // 隐藏所有标签内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有标签的活动状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的标签内容
            document.getElementById(tabId).classList.add('active');
            
            // 激活选中的标签
            event.target.classList.add('active');
        }

        function generateTextFavicon() {
            const text = document.getElementById('faviconText').value.trim();
            if (!text) {
                showStatus('请输入文字', 'error');
                return;
            }

            const fontFamily = document.getElementById('fontFamily').value;
            const backgroundColor = document.getElementById('backgroundColor').value;
            const textColor = document.getElementById('textColor').value;

            currentCanvases = {};
            const previewContainer = document.getElementById('textPreviewContainer');
            previewContainer.innerHTML = '';

            selectedSizes.forEach(size => {
                const canvas = createTextCanvas(text, size, fontFamily, backgroundColor, textColor);
                currentCanvases[size] = canvas;
                
                const container = document.createElement('div');
                container.className = 'canvas-container';
                
                const label = document.createElement('div');
                label.className = 'canvas-size-label';
                label.textContent = `${size}×${size}`;
                
                container.appendChild(canvas);
                container.appendChild(label);
                previewContainer.appendChild(container);
            });

            document.getElementById('downloadBtn').disabled = false;
            showStatus('✅ Favicon 生成成功！', 'success');
        }

        function createTextCanvas(text, size, fontFamily, backgroundColor, textColor) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = size;
            canvas.height = size;
            
            // 设置背景
            ctx.fillStyle = backgroundColor;
            ctx.fillRect(0, 0, size, size);
            
            // 设置文字
            ctx.fillStyle = textColor;
            ctx.font = `bold ${Math.floor(size * 0.6)}px ${fontFamily}`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // 绘制文字
            ctx.fillText(text, size / 2, size / 2);
            
            return canvas;
        }

        function generateImageFavicon() {
            if (!uploadedImage) {
                showStatus('请先上传图片', 'error');
                return;
            }

            currentCanvases = {};
            const previewContainer = document.getElementById('imagePreviewContainer');
            previewContainer.innerHTML = '';

            selectedSizes.forEach(size => {
                const canvas = createImageCanvas(uploadedImage, size);
                currentCanvases[size] = canvas;
                
                const container = document.createElement('div');
                container.className = 'canvas-container';
                
                const label = document.createElement('div');
                label.className = 'canvas-size-label';
                label.textContent = `${size}×${size}`;
                
                container.appendChild(canvas);
                container.appendChild(label);
                previewContainer.appendChild(container);
            });

            document.getElementById('downloadBtn').disabled = false;
            showStatus('✅ Favicon 生成成功！', 'success');
        }

        function createImageCanvas(image, size) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = size;
            canvas.height = size;
            
            // 清除背景（透明）
            ctx.clearRect(0, 0, size, size);
            
            // 计算缩放比例
            const scale = Math.min(size / image.width, size / image.height);
            const scaledWidth = image.width * scale;
            const scaledHeight = image.height * scale;
            
            // 居中绘制
            const x = (size - scaledWidth) / 2;
            const y = (size - scaledHeight) / 2;
            
            ctx.drawImage(image, x, y, scaledWidth, scaledHeight);
            
            return canvas;
        }

        function randomColors() {
            const colors = [
                '#667eea', '#764ba2', '#f093fb', '#f5576c',
                '#4facfe', '#00f2fe', '#43e97b', '#38f9d7',
                '#ffecd2', '#fcb69f', '#a8edea', '#fed6e3',
                '#ff9a9e', '#fecfef', '#ffeaa7', '#fab1a0'
            ];
            
            const bgColor = colors[Math.floor(Math.random() * colors.length)];
            let textColor = colors[Math.floor(Math.random() * colors.length)];
            
            // 确保文字颜色与背景颜色不同
            while (textColor === bgColor) {
                textColor = colors[Math.floor(Math.random() * colors.length)];
            }
            
            document.getElementById('backgroundColor').value = bgColor;
            document.getElementById('textColor').value = textColor;
            
            showStatus('🎲 已应用随机配色', 'info');
        }

        function setupImageUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const imageInput = document.getElementById('imageInput');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageFile(files[0]);
                }
            });
            
            imageInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleImageFile(e.target.files[0]);
                }
            });
        }

        function handleImageFile(file) {
            if (!file.type.startsWith('image/')) {
                showStatus('请选择图片文件', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    uploadedImage = img;
                    showStatus(`📁 图片上传成功: ${file.name}`, 'success');
                    
                    // 自动生成预览
                    generateImageFavicon();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function clearImage() {
            uploadedImage = null;
            document.getElementById('imageInput').value = '';
            document.getElementById('imagePreviewContainer').innerHTML = '';
            document.getElementById('downloadBtn').disabled = true;
            showStatus('🗑️ 已清除图片', 'info');
        }

        function setupSizeSelector() {
            const sizeButtons = document.querySelectorAll('.size-btn');
            
            sizeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.classList.toggle('active');
                    updateSelectedSizes();
                });
            });
        }

        function updateSelectedSizes() {
            const activeBtns = document.querySelectorAll('.size-btn.active');
            selectedSizes.length = 0;
            
            activeBtns.forEach(btn => {
                selectedSizes.push(parseInt(btn.dataset.size));
            });
            
            if (selectedSizes.length === 0) {
                showStatus('请至少选择一个尺寸', 'error');
                return;
            }
            
            // 重新生成预览（如果有内容的话）
            const currentTab = document.querySelector('.tab.active').onclick.toString();
            if (currentTab.includes('text-generator') && document.getElementById('faviconText').value.trim()) {
                generateTextFavicon();
            } else if (currentTab.includes('image-upload') && uploadedImage) {
                generateImageFavicon();
            }
        }

        function setupFormatSelector() {
            const formatOptions = document.querySelectorAll('.format-option');
            
            formatOptions.forEach(option => {
                option.addEventListener('click', () => {
                    formatOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                });
            });
        }

        function downloadFavicons() {
            if (Object.keys(currentCanvases).length === 0) {
                showStatus('请先生成 Favicon', 'error');
                return;
            }
            
            const selectedFormat = document.querySelector('.format-option.selected').dataset.format;
            
            if (selectedFormat === 'ico') {
                downloadAsICO();
            } else if (selectedFormat === 'png') {
                downloadAsPNG();
            } else if (selectedFormat === 'svg') {
                downloadAsSVG();
            }
        }

        function downloadAsPNG() {
            // 下载最大尺寸的 PNG
            const maxSize = Math.max(...Object.keys(currentCanvases).map(Number));
            const canvas = currentCanvases[maxSize];
            
            canvas.toBlob((blob) => {
                downloadBlob(blob, `favicon-${maxSize}x${maxSize}.png`);
                showStatus('💾 PNG 文件下载成功！', 'success');
            }, 'image/png');
        }

        function downloadAsICO() {
            // 这里简化处理，下载 32x32 的 PNG（实际项目中需要更复杂的 ICO 格式处理）
            const canvas = currentCanvases[32] || currentCanvases[Object.keys(currentCanvases)[0]];
            
            canvas.toBlob((blob) => {
                downloadBlob(blob, 'favicon.ico');
                showStatus('💾 ICO 文件下载成功！', 'success');
            }, 'image/png');
        }

        function downloadAsSVG() {
            // 生成 SVG 版本（仅适用于文字）
            const activeTab = document.querySelector('.tab.active');
            if (!activeTab.onclick.toString().includes('text-generator')) {
                showStatus('SVG 格式仅支持文字生成模式', 'error');
                return;
            }
            
            const text = document.getElementById('faviconText').value.trim();
            const fontFamily = document.getElementById('fontFamily').value;
            const backgroundColor = document.getElementById('backgroundColor').value;
            const textColor = document.getElementById('textColor').value;
            
            const svg = createSVGFavicon(text, fontFamily, backgroundColor, textColor);
            const blob = new Blob([svg], { type: 'image/svg+xml' });
            downloadBlob(blob, 'favicon.svg');
            showStatus('💾 SVG 文件下载成功！', 'success');
        }

        function createSVGFavicon(text, fontFamily, backgroundColor, textColor) {
            return `<?xml version="1.0" encoding="UTF-8"?>
<svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
    <rect width="32" height="32" fill="${backgroundColor}"/>
    <text x="16" y="20" font-family="${fontFamily}" font-size="20" font-weight="bold" 
          text-anchor="middle" fill="${textColor}">${text}</text>
</svg>`;
        }

        function downloadAll() {
            if (Object.keys(currentCanvases).length === 0) {
                showStatus('请先生成 Favicon', 'error');
                return;
            }
            
            let downloadCount = 0;
            const totalDownloads = Object.keys(currentCanvases).length;
            
            Object.entries(currentCanvases).forEach(([size, canvas]) => {
                canvas.toBlob((blob) => {
                    downloadBlob(blob, `favicon-${size}x${size}.png`);
                    downloadCount++;
                    
                    if (downloadCount === totalDownloads) {
                        showStatus(`📦 已下载 ${totalDownloads} 个不同尺寸的文件！`, 'success');
                    }
                }, 'image/png');
            });
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 实时预览
        function setupRealTimePreview() {
            const textInput = document.getElementById('faviconText');
            const fontSelect = document.getElementById('fontFamily');
            const bgColor = document.getElementById('backgroundColor');
            const textColor = document.getElementById('textColor');
            
            let timeout;
            
            function scheduleUpdate() {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    if (textInput.value.trim()) {
                        generateTextFavicon();
                    }
                }, 500);
            }
            
            textInput.addEventListener('input', scheduleUpdate);
            fontSelect.addEventListener('change', scheduleUpdate);
            bgColor.addEventListener('change', scheduleUpdate);
            textColor.addEventListener('change', scheduleUpdate);
        }

        // 初始化
        window.addEventListener('load', function() {
            setupImageUpload();
            setupSizeSelector();
            setupFormatSelector();
            setupRealTimePreview();
            
            // 生成初始预览
            generateTextFavicon();
        });
    
                return input;
            }

            displayResult(result) {
                document.getElementById('resultContent').textContent = result;
            }

            clear() {
                document.getElementById('input').value = '';
                document.getElementById('resultContent').textContent = '处理结果将在这里显示...';
            }

            copyResult() {
                const result = document.getElementById('resultContent').textContent;
                if (result && result !== '处理结果将在这里显示...') {
                    ToolUtils.copyToClipboard(result);
                } else {
                    ToolUtils.showToast('没有可复制的内容', 'warning');
                }
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            new ToolApp();
        });
    </script>
</body>
</html>
